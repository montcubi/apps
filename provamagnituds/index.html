    <style>
        /* Estils generals */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        main {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        h1, h2 {
            color: #005a9c; /* Blau corporatiu */
            border-bottom: 2px solid #005a9c;
            padding-bottom: 5px;
        }
        h1 { font-size: 1.8em; }
        h2 { font-size: 1.4em; margin-top: 30px; }

        /* Estils pel nom */
        .nom-container {
            margin-bottom: 20px;
            background-color: #e6f0f8;
            padding: 15px;
            border-radius: 5px;
        }
        .nom-container label {
            font-weight: bold;
            margin-right: 10px;
        }
        .nom-container input[type="text"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 300px;
        }

        /* Activitat 1: Qüestionari */
        .pregunta {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #fafafa;
            border-left: 4px solid #007b8a; /* Verd/blau */
        }
        .pregunta label {
            display: inline-block;
            width: 300px; /* Alineació */
        }
        .pregunta select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-family: inherit;
        }

        /* Activitat 2: Arrossegar */
        .drag-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap; /* Millora per a mòbils */
        }
        .drop-zone {
            width: 100%; /* Canviat per a mòbils */
            min-height: 200px;
            border: 2px dashed #aaa;
            border-radius: 8px;
            padding: 10px;
            background-color: #fdfdfd;
        }
        @media (min-width: 600px) {
            .drop-zone {
                width: 48%; /* Torna a 2 columnes en pantalles grans */
            }
        }
        .drop-zone h3 {
            margin-top: 0;
            text-align: center;
            color: #555;
        }
        #caixa-magnituds {
            width: 100%;
            padding: 10px;
            background-color: #e6f0f8;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        .drag-item {
            display: inline-block;
            background-color: #007b8a;
            color: white;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            cursor: move; /* Indica que es pot moure */
            font-weight: bold;
            user-select: none; /* Evita seleccionar text */
        }
        .drag-item.dragging {
            opacity: 0.5;
        }
        .drop-zone .drag-item {
            background-color: #005a9c;
        }

        /* Activitat 3: Text */
        #text-activitat-3 {
            background-color: #fdfdfd;
            border: 1px solid #eee;
            padding: 15px; /* Ajust per padding */
            border-radius: 5px;
            line-height: 1.7;
            font-style: italic;
            margin-bottom: 15px;
            position: sticky;
            top: 20px;
            z-index: 10;
        }
        .form-scroll-container {
            max-height: 400px; /* Altura màxima abans de fer scroll */
            overflow-y: auto; /* Activa l'scroll vertical si cal */
            padding-right: 15px; /* Espai per la barra de scroll */
            border: 1px solid #eee;
            border-radius: 5px;
        }
        .fila-magnitud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background-color: #fafafa;
            border-left: 4px solid #6c757d; /* Gris */
        }
        .fila-magnitud label {
            font-weight: bold;
            margin-right: 5px;
        }
        .fila-magnitud select, .fila-magnitud input[type="text"] {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-family: inherit;
        }
        .fila-magnitud input[type="text"] {
            width: 80px; /* Amplada fixa pel valor */
        }
        .unitat-input, .simbol-input {
            width: 100px; /* Amplada per a les unitats i símbols */
        }

        /* Botó final */
        #boto-final {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            background-color: #28a745; /* Verd */
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 30px;
        }
        #boto-final:hover {
            background-color: #218838;
        }
        
        /* Modal d'avís (substitut d'alert) */
        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-content p {
            font-size: 1.1em;
        }
        .modal-content button {
            background-color: #005a9c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
        }
        .modal-content button:hover {
            background-color: #004a80;
        }


        /* Estils per l'informe (ocult per defecte) */
        #informe {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        #informe h1 {
            color: #333;
            border-bottom: 2px solid #333;
        }
        .resultat-bloc {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        .resultat-bloc h2 {
            color: #005a9c;
            border: none;
        }
        .resultat-text {
            margin-top: 10px;
        }
        .resultat-text ul {
            margin: 0;
            padding-left: 20px;
        }
        .resultat-text .respostes-titol {
            font-weight: bold;
            margin: 0 0 5px;
        }
        .resultat-text .resposta-cap {
            font-style: italic;
            margin: 0;
        }
        .puntuacio-final {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            color: #28a745;
            padding: 15px;
            background-color: #f4f7f6;
            border-radius: 5px;
        }

        /* Estil per amagar coses a l'imprimir */
        @media print {
            body { padding: 0; }
            main { box-shadow: none; border: 1px solid #ccc; }
            #boto-final, .modal-overlay { display: none; }
            #informe { display: block !important; border: none; }
            #contingut-principal { display: none !important; }
        }

    </style>
</head>
<body>

    <!-- Modal per avisos -->
    <div id="modal-avís" class="modal-overlay">
        <div class="modal-content">
            <p id="modal-text"></p>
            <button id="modal-tancar">Entès</button>
        </div>
    </div>

    <main id="contingut-principal">
        <h1>Activitat Interactiva: Magnituds i Unitats</h1>

        <div class="nom-container">
            <label for="nom-alumne">Nom i Cognoms:</label>
            <input type="text" id="nom-alumne" placeholder="Escriu el teu nom aquí">
        </div>

        <!-- ACTIVITAT 1: COMPLETAR UNITATS -->
        <section id="activitat-1">
            <h2>Activitat 1: Unitats del Sistema Internacional (SI)</h2>
            <p>Completa cada frase amb la unitat del SI correcta.</p>
            <form id="quiz-unitats">
                <div class="pregunta">
                    <label for="q1">temps de caiguda d’un cos, 4...</label>
                    <select id="q1" aria-label="Temps de caiguda d'un cos">
                        <option value="">--Tria--</option>
                        <option value="h">h</option>
                        <option value="min">min</option>
                        <option value="s">s</option>
                        <option value="ms">ms</option>
                        <option value="kg">kg</option>
                        <option value="m">m</option>
                        <option value="m/s">m/s</option>
                        <option value="km/h">km/h</option>
                    </select>
                </div>
                <div class="pregunta">
                    <label for="q2">volum d’un sòlid, 48...</label>
                    <select id="q2" aria-label="Volum d'un sòlid">
                        <option value="">--Tria--</option>
                        <option value="m3">m3</option>
                        <option value="L">L</option>
                        <option value="cm3">cm3</option>
                        <option value="ml">ml</option>
                        <option value="m2">m2</option>
                        <option value="kg">kg</option>
                        <option value="m">m</option>
                        <option value="s">s</option>
                    </select>
                </div>
                <div class="pregunta">
                    <label for="q3">massa d’una persona, 72...</label>
                    <select id="q3" aria-label="Massa d'una persona">
                        <option value="">--Tria--</option>
                        <option value="kg">kg</option>
                        <option value="g">g</option>
                        <option value="mg">mg</option>
                        <option value="t">t</option>
                        <option value="N">N</option>
                        <option value="m">m</option>
                        <option value="s">s</option>
                        <option value="L">L</option>
                    </select>
                </div>
                <div class="pregunta">
                    <label for="q4">velocitat d’una persona en caminar, 1,4...</label>
                    <select id="q4" aria-label="Velocitat d'una persona en caminar">
                        <option value="">--Tria--</option>
                        <option value="m/s">m/s</option>
                        <option value="km/h">km/h</option>
                        <option value="cm/s">cm/s</option>
                        <option value="m/min">m/min</option>
                        <option value="s">s</option>
                        <option value="m">m</option>
                        <option value="kg">kg</option>
                        <option value="L">L</option>
                    </select>
                </div>
                <div class="pregunta">
                    <label for="q5">superfície de la teva habitació, 12...</label>
                    <select id="q5" aria-label="Superfície de la teva habitació">
                        <option value="">--Tria--</option>
                        <option value="m2">m2</option>
                        <option value="cm2">cm2</option>
                        <option value="mm2">mm2</option>
                        <option value="km2">km2</option>
                        <option value="m3">m3</option>
                        <option value="m">m</option>
                        <option value="s">s</option>
                        <option value="kg">kg</option>
                    </select>
                </div>
                <div class="pregunta">
                    <label for="q6">alçada d’una persona, 1,80...</label>
                    <select id="q6" aria-label="Alçada d'una persona">
                        <option value="">--Tria--</option>
                        <option value="m">m</option>
                        <option value="cm">cm</option>
                        <option value="mm">mm</option>
                        <option value="km">km</option>
                        <option value="kg">kg</option>
                        <option value="s">s</option>
                        <option value="L">L</option>
                        <option value="m/s">m/s</option>
                    </select>
                </div>
            </form>
        </section>

                <!-- ACTIVITAT 2: CLASSIFICAR MAGNITUDS -->
                <section id="activitat-2">
                    <h2>Activitat 2: Magnituds Bàsiques vs. Derivades</h2>
                    <p>Arrossega cada magnitud a la caixa correcta.</p>
                    
                    <div id="caixa-magnituds">
                        <div class="drag-item" draggable="true" data-id="longitud">Longitud</div>
                        <div class="drag-item" draggable="true" data-id="velocitat">Velocitat</div>
                        <div class="drag-item" draggable="true" data-id="massa">Massa</div>
                        <div class="drag-item" draggable="true" data-id="superficie">Superfície</div>
                        <div class="drag-item" draggable="true" data-id="temps">Temps</div>
                        <div class="drag-item" draggable="true" data-id="volum">Volum</div>
                        <div class="drag-item" draggable="true" data-id="temperatura">Temperatura</div>
                        <div class="drag-item" draggable="true" data-id="densitat">Densitat</div>
                        <div class="drag-item" draggable="true" data-id="intensitat">Intensitat</div>
                        <div class="drag-item" draggable="true" data-id="pressio">Pressió</div>
                    </div>
        
                    <div class="drag-container">
                        <div class="drop-zone" id="zona-basiques">
                            <h3>MAGNITUDS BÀSIQUES</h3>
                        </div>
                        <div class="drop-zone" id="zona-derivades">
                            <h3>MAGNITUDS DERIVADES</h3>
                        </div>
                    </div>
                </section>
        
                <!-- ACTIVITAT 3: IDENTIFICAR EN TEXT -->
                <section id="activitat-3">
                    <h2>Activitat 3: Anàlisi de text (Magnituds i Unitats)</h2>
                    <p>Llegeix el text següent i identifica 8 magnituds diferents. Completa tota la informació de la taula per a cadascuna.</p>
                    <p><em>(Atenció: és important escriure les unitats exactament com apareixen al text, incloent accents i majúscules.)</em></p>
                    
                    <div id="text-activitat-3">
                        <p>Un diumenge de primavera, l’Anna i els seus amics van decidir fer una excursió a una muntanya propera. Van sortir a les 8 del matí i van començar a caminar a quatre quilòmetres per hora.</p>
                        <p>Despres de 3 hores de pujada, van arribar a una clariana i van decidir fer una pausa per esmorzar. Estava cansada perquè la motxilla li pesava quasibé 2400 grams.</p>
                        <p>Quan van reprendre la caminada, van trobar una font natural. Cada membre del grup va omplir les seves ampolles aprofitant l’ocasió. Portaven ampolles de 500 centímetres cúbics, l’Anna va comprovar que la temperatura de l’aigua no havia canviat massa, s’havia mantingut fresqueta a uns 12 °C. “No m’estranya que sigui tan refrescant”, va pensar.</p>
                        <p>Cap al migdia, van arribar al cim, situat a 1200 metres sobre el nivell del mar. Des d’allà, podien veure un gran i bonic llac de 5000 metres quadrats al fons de la vall. Van decidir baixar-hi per dinar, però de cop i volta es va posar a ploure; l’home del temps ja havia dit que les precipitacions podrien arribar a més de quinze litres aquell dia.</p>
                        <p>Així doncs, van tornar cap a casa. L’Anna es va adonar que havien caminat tant que  el seu rellotge esportiu li indicava que havia cremat 1500 juls durant l’expedició. Estava cansada, però molt contenta d’haver gaudit d’un dia de natura.</p>
                    </div>
        
                    <form id="quiz-text">
                            <!-- Fila 1 -->
                            <div class="fila-magnitud">
                                <label for="v1">Valor:</label>
                                <input type="text" id="v1" class="valor-input" placeholder="Ex: 12" aria-label="Escriure valor 1">
                                <label for="u1">Unitat (text):</label>
                                <input type="text" id="u1" class="unitat-input" placeholder="Ex: quilòmetres" aria-label="Escriure unitat 1">
                                <label for="s1">Símbol:</label>
                                <input type="text" id="s1" class="simbol-input" placeholder="Ex: km" aria-label="Escriure símbol 1">
                                <label for="m1">Magnitud:</label>
                                <select id="m1" class="magnitud-select" aria-label="Seleccionar magnitud 1">
                                    <option value="">--Magnitud--</option>
                                    <option value="velocitat">Velocitat</option>
                                    <option value="temps">Temps</option>
                                    <option value="longitud">Longitud/Distància</option>
                                    <option value="massa">Massa</option>
                                    <option value="volum">Volum</option>
                                    <option value="temperatura">Temperatura</option>
                                    <option value="superficie">Superfície</option>
                                    <option value="energia">Energia</option>
                                    <option value="densitat">Densitat</option>
                                    <option value="forca">Força</option>
                                    <option value="intensitat">Intensitat</option>
                                    <option value="pressio">Pressió</option>
                                    <option value="potencia">Potència</option>
                                    <option value="frequencia">Freqüència</option>
                                </select>
                                <label for="si1">Està en SI?:</label>
                                <select id="si1" class="si-select" aria-label="Seleccionar si està en SI 1">
                                    <option value="">--SI?--</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <!-- Repetir per les 8 files -->
                            <!-- Fila 2 -->
                            <div class="fila-magnitud">
                                <label for="v2">Valor:</label>
                                <input type="text" id="v2" class="valor-input" placeholder="" aria-label="Escriure valor 2">
                                <label for="u2">Unitat (text):</label>
                                <input type="text" id="u2" class="unitat-input" placeholder="" aria-label="Escriure unitat 2">
                                <label for="s2">Símbol:</label>
                                <input type="text" id="s2" class="simbol-input" placeholder="" aria-label="Escriure símbol 2">
                                <label for="m2">Magnitud:</label>
                                <select id="m2" class="magnitud-select" aria-label="Seleccionar magnitud 2">
                                    <option value="">--Magnitud--</option>
                                    <option value="velocitat">Velocitat</option>
                                    <option value="temps">Temps</option>
                                    <option value="longitud">Longitud/Distància</option>
                                    <option value="massa">Massa</option>
                                    <option value="volum">Volum</option>
                                    <option value="temperatura">Temperatura</option>
                                    <option value="superficie">Superfície</option>
                                    <option value="energia">Energia</option>
                                    <option value="densitat">Densitat</option>
                                    <option value="forca">Força</option>
                                    <option value="intensitat">Intensitat</option>
                                    <option value="pressio">Pressió</option>
                                    <option value="potencia">Potència</option>
                                    <option value="frequencia">Freqüència</option>
                                </select>
                                <label for="si2">Està en SI?:</label>
                                <select id="si2" class="si-select" aria-label="Seleccionar si està en SI 2">
                                    <option value="">--SI?--</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <!-- Fila 3 -->
                            <div class="fila-magnitud">
                                <label for="v3">Valor:</label>
                                <input type="text" id="v3" class="valor-input" placeholder="" aria-label="Escriure valor 3">
                                <label for="u3">Unitat (text):</label>
                                <input type="text" id="u3" class="unitat-input" placeholder="" aria-label="Escriure unitat 3">
                                <label for="s3">Símbol:</label>
                                <input type="text" id="s3" class="simbol-input" placeholder="" aria-label="Escriure símbol 3">
                                <label for="m3">Magnitud:</label>
                                <select id="m3" class="magnitud-select" aria-label="Seleccionar magnitud 3">
                                    <option value="">--Magnitud--</option>
                                    <option value="velocitat">Velocitat</option>
                                    <option value="temps">Temps</option>
                                    <option value="longitud">Longitud/Distància</option>
                                    <option value="massa">Massa</option>
                                    <option value="volum">Volum</option>
                                    <option value="temperatura">Temperatura</option>
                                    <option value="superficie">Superfície</option>
                                    <option value="energia">Energia</option>
                                    <option value="densitat">Densitat</option>
                                    <option value="forca">Força</option>
                                    <option value="intensitat">Intensitat</option>
                                    <option value="pressio">Pressió</option>
                                    <option value="potencia">Potència</option>
                                    <option value="frequencia">Freqüència</option>
                                </select>
                                <label for="si3">Està en SI?:</label>
                                <select id="si3" class="si-select" aria-label="Seleccionar si està en SI 3">
                                    <option value="">--SI?--</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <!-- Fila 4 -->
                            <div class="fila-magnitud">
                                <label for="v4">Valor:</label>
                                <input type="text" id="v4" class="valor-input" placeholder="" aria-label="Escriure valor 4">
                                <label for="u4">Unitat (text):</label>
                                <input type="text" id="u4" class="unitat-input" placeholder="" aria-label="Escriure unitat 4">
                                <label for="s4">Símbol:</label>
                                <input type="text" id="s4" class="simbol-input" placeholder="" aria-label="Escriure símbol 4">
                                <label for="m4">Magnitud:</label>
                                <select id="m4" class="magnitud-select" aria-label="Seleccionar magnitud 4">
                                    <option value="">--Magnitud--</option>
                                    <option value="velocitat">Velocitat</option>
                                    <option value="temps">Temps</option>
                                    <option value="longitud">Longitud/Distància</option>
                                    <option value="massa">Massa</option>
                                    <option value="volum">Volum</option>
                                    <option value="temperatura">Temperatura</option>
                                    <option value="superficie">Superfície</option>
                                    <option value="energia">Energia</option>
                                    <option value="densitat">Densitat</option>
                                    <option value="forca">Força</option>
                                    <option value="intensitat">Intensitat</option>
                                    <option value="pressio">Pressió</option>
                                    <option value="potencia">Potència</option>
                                    <option value="frequencia">Freqüència</option>
                                </select>
                                <label for="si4">Està en SI?:</label>
                                <select id="si4" class="si-select" aria-label="Seleccionar si està en SI 4">
                                    <option value="">--SI?--</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <!-- Fila 5 -->
                            <div class="fila-magnitud">
                                <label for="v5">Valor:</label>
                                <input type="text" id="v5" class="valor-input" placeholder="" aria-label="Escriure valor 5">
                                <label for="u5">Unitat (text):</label>
                                <input type="text" id="u5" class="unitat-input" placeholder="" aria-label="Escriure unitat 5">
                                <label for="s5">Símbol:</label>
                                <input type="text" id="s5" class="simbol-input" placeholder="" aria-label="Escriure símbol 5">
                                <label for="m5">Magnitud:</label>
                                <select id="m5" class="magnitud-select" aria-label="Seleccionar magnitud 5">
                                    <option value="">--Magnitud--</option>
                                    <option value="velocitat">Velocitat</option>
                                    <option value="temps">Temps</option>
                                    <option value="longitud">Longitud/Distància</option>
                                    <option value="massa">Massa</option>
                                    <option value="volum">Volum</option>
                                    <option value="temperatura">Temperatura</option>
                                    <option value="superficie">Superfície</option>
                                    <option value="energia">Energia</option>
                                    <option value="densitat">Densitat</option>
                                    <option value="forca">Força</option>
                                    <option value="intensitat">Intensitat</option>
                                    <option value="pressio">Pressió</option>
                                    <option value="potencia">Potència</option>
                                    <option value="frequencia">Freqüència</option>
                                </select>
                                <label for="si5">Està en SI?:</label>
                                <select id="si5" class="si-select" aria-label="Seleccionar si està en SI 5">
                                    <option value="">--SI?--</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <!-- Fila 6 -->
                            <div class="fila-magnitud">
                                <label for="v6">Valor:</label>
                                <input type="text" id="v6" class="valor-input" placeholder="" aria-label="Escriure valor 6">
                                <label for="u6">Unitat (text):</label>
                                <input type="text" id="u6" class="unitat-input" placeholder="" aria-label="Escriure unitat 6">
                                <label for="s6">Símbol:</label>
                                <input type="text" id="s6" class="simbol-input" placeholder="" aria-label="Escriure símbol 6">
                                <label for="m6">Magnitud:</label>
                                <select id="m6" class="magnitud-select" aria-label="Seleccionar magnitud 6">
                                    <option value="">--Magnitud--</option>
                                    <option value="velocitat">Velocitat</option>
                                    <option value="temps">Temps</option>
                                    <option value="longitud">Longitud/Distància</option>
                                    <option value="massa">Massa</option>
                                    <option value="volum">Volum</option>
                                    <option value="temperatura">Temperatura</option>
                                    <option value="superficie">Superfície</option>
                                    <option value="energia">Energia</option>
                                    <option value="densitat">Densitat</option>
                                    <option value="forca">Força</option>
                                    <option value="intensitat">Intensitat</option>
                                    <option value="pressio">Pressió</option>
                                    <option value="potencia">Potència</option>
                                    <option value="frequencia">Freqüència</option>
                                </select>
                                <label for="si6">Està en SI?:</label>
                                <select id="si6" class="si-select" aria-label="Seleccionar si està en SI 6">
                                    <option value="">--SI?--</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <!-- Fila 7 -->
                            <div class="fila-magnitud">
                                <label for="v7">Valor:</label>
                                <input type="text" id="v7" class="valor-input" placeholder="" aria-label="Escriure valor 7">
                                <label for="u7">Unitat (text):</label>
                                <input type="text" id="u7" class="unitat-input" placeholder="" aria-label="Escriure unitat 7">
                                <label for="s7">Símbol:</label>
                                <input type="text" id="s7" class="simbol-input" placeholder="" aria-label="Escriure símbol 7">
                                <label for="m7">Magnitud:</label>
                                <select id="m7" class="magnitud-select" aria-label="Seleccionar magnitud 7">
                                    <option value="">--Magnitud--</option>
                                    <option value="velocitat">Velocitat</option>
                                    <option value="temps">Temps</option>
                                    <option value="longitud">Longitud/Distància</option>
                                    <option value="massa">Massa</option>
                                    <option value="volum">Volum</option>
                                    <option value="temperatura">Temperatura</option>
                                    <option value="superficie">Superfície</option>
                                    <option value="energia">Energia</option>
                                    <option value="densitat">Densitat</option>
                                    <option value="forca">Força</option>
                                    <option value="intensitat">Intensitat</option>
                                    <option value="pressio">Pressió</option>
                                    <option value="potencia">Potència</option>
                                    <option value="frequencia">Freqüència</option>
                                </select>
                                <label for="si7">Està en SI?:</label>
                                <select id="si7" class="si-select" aria-label="Seleccionar si està en SI 7">
                                    <option value="">--SI?--</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <!-- Fila 8 -->
                            <div class="fila-magnitud">
                                <label for="v8">Valor:</label>
                                <input type="text" id="v8" class="valor-input" placeholder="" aria-label="Escriure valor 8">
                                <label for="u8">Unitat (text):</label>
                                <input type="text" id="u8" class="unitat-input" placeholder="" aria-label="Escriure unitat 8">
                                <label for="s8">Símbol:</label>
                                <input type="text" id="s8" class="simbol-input" placeholder="" aria-label="Escriure símbol 8">
                                <label for="m8">Magnitud:</label>
                                <select id="m8" class="magnitud-select" aria-label="Seleccionar magnitud 8">
                                    <option value="">--Magnitud--</option>
                                    <option value="velocitat">Velocitat</option>
                                    <option value="temps">Temps</option>
                                    <option value="longitud">Longitud/Distància</option>
                                    <option value="massa">Massa</option>
                                    <option value="volum">Volum</option>
                                    <option value="temperatura">Temperatura</option>
                                    <option value="superficie">Superfície</option>
                                    <option value="energia">Energia</option>
                                    <option value="densitat">Densitat</option>
                                    <option value="forca">Força</option>
                                    <option value="intensitat">Intensitat</option>
                                    <option value="pressio">Pressió</option>
                                    <option value="potencia">Potència</option>
                                    <option value="frequencia">Freqüència</option>
                                </select>
                                <label for="si8">Està en SI?:</label>
                                <select id="si8" class="si-select" aria-label="Seleccionar si està en SI 8">
                                    <option value="">--SI?--</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </section>
    <button id="boto-final">Finalitza, Genera l'Informe i Desa com a PDF</button>

</main>

<!-- Aquesta secció està oculta i només es mostra per l'informe -->
<div id="informe">
    <h1>Informe de resultats</h1>
    <div class="resultat-bloc">
        <strong>Alumne/a:</strong> <span id="informe-nom"></span>
    </div>
    
    <div class="resultat-bloc" id="informe-act1">
        <h2>Activitat 1: Unitats del SI</h2>
        <div id="resultat-act1" class="resultat-text"></div>
    </div>
    
    <div class="resultat-bloc" id="informe-act2">
        <h2>Activitat 2: Classificació de Magnituds</h2>
        <div id="resultat-act2" class="resultat-text"></div>
    </div>
    
    <div class="resultat-bloc" id="informe-act3">
        <h2>Activitat 3: Anàlisi de Text</h2>
        <div id="resultat-act3" class="resultat-text"></div>
    </div>
    
    <div class="puntuacio-final" id="informe-final">
        Puntuació total: <span id="nota-final"></span>
    </div>
</div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        // --- LÒGICA PER AL MODAL (SUBSTITUT D'ALERT) ---
        const modal = document.getElementById('modal-avís');
        const modalText = document.getElementById('modal-text');
        const modalTancar = document.getElementById('modal-tancar');

        function mostrarAvís(text) {
            modalText.textContent = text;
            modal.style.display = 'block';
        }

        modalTancar.addEventListener('click', () => {
            modal.style.display = 'none';
        });
        window.addEventListener('click', (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });

        const emplenaBlocErrors = (node, errors) => {
            node.innerHTML = '';
            if (!errors.length) {
                const missatge = document.createElement('p');
                missatge.classList.add('resposta-cap');
                missatge.textContent = 'Cap resposta incorrecta en aquesta activitat.';
                node.appendChild(missatge);
                return;
            }
            const titol = document.createElement('p');
            titol.classList.add('respostes-titol');
            titol.textContent = 'Respostes incorrectes:';
            node.appendChild(titol);
            const llista = document.createElement('ul');
            errors.forEach(error => {
                const element = document.createElement('li');
                element.textContent = error;
                llista.appendChild(element);
            });
            node.appendChild(llista);
        };

        function generaPdfInforme({ nomAlumne, notaFinal, errorsAct1, errorsAct2, errorsAct3 }) {
            if (!window.jspdf || !window.jspdf.jsPDF) {
                mostrarAvís("No s'ha pogut generar automàticament el PDF. Torna-ho a intentar més tard.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const marge = 15;
            let posicio = 20;

            const comprovaEspai = (alcadaExtra = 0) => {
                if (posicio + alcadaExtra > 280) {
                    doc.addPage();
                    posicio = 20;
                }
            };

            const escriuBloc = (titol, errors) => {
                doc.setFontSize(13);
                comprovaEspai(6);
                doc.text(titol, marge, posicio);
                posicio += 6;
                doc.setFontSize(11);
                const frases = errors.length ? errors : ["Cap resposta incorrecta."];
                frases.forEach(frase => {
                    const linees = doc.splitTextToSize(frase, 180);
                    linees.forEach(linia => {
                        comprovaEspai(6);
                        doc.text(linia, marge, posicio);
                        posicio += 6;
                    });
                });
                posicio += 4;
            };

            doc.setFontSize(16);
            doc.text("Informe de resultats", marge, posicio);
            posicio += 8;
            doc.setFontSize(12);
            doc.text(`Alumne/a: ${nomAlumne}`, marge, posicio);
            posicio += 6;
            doc.text(`Puntuació final: ${notaFinal.toFixed(2)} / 10`, marge, posicio);
            posicio += 10;

            escriuBloc("Activitat 1 - Unitats del SI", errorsAct1);
            escriuBloc("Activitat 2 - Classificació de magnituds", errorsAct2);
            escriuBloc("Activitat 3 - Anàlisi de text", errorsAct3);

            const nomNet = nomAlumne.trim().toLowerCase().replace(/[^a-z0-9]+/gi, '_').replace(/^_+|_+$/g, '');
            const nomFitxer = `informe_${nomNet || 'alumne'}.pdf`;
            doc.save(nomFitxer);
        }

        // --- LÒGICA PER L'ACTIVITAT 2 (ARROSSEGAR) ---
        const items = document.querySelectorAll('.drag-item');
        const zones = document.querySelectorAll('.drop-zone');
        let itemArrossegat = null;

        items.forEach(item => {
            item.addEventListener('dragstart', (e) => {
                item.classList.add('dragging');
                itemArrossegat = item;
                e.dataTransfer.effectAllowed = 'move';
            });
            item.addEventListener('dragend', () => {
                item.classList.remove('dragging');
                itemArrossegat = null;
            });

            // Suport per a dispositius tàctils
            item.addEventListener('touchstart', (e) => {
                item.classList.add('dragging');
                itemArrossegat = item;
                e.preventDefault();
            }, { passive: false });

            item.addEventListener('touchend', (e) => {
                if (itemArrossegat) {
                    const touch = e.changedTouches[0];
                    const dropZone = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.drop-zone, #caixa-magnituds');

                    if (dropZone) {
                        dropZone.appendChild(itemArrossegat);
                    }
                    
                    itemArrossegat.classList.remove('dragging');
                    itemArrossegat = null;
                }
            });
        });

        zones.forEach(zone => {
            zone.addEventListener('dragover', e => {
                e.preventDefault();
            });

            zone.addEventListener('drop', e => {
                e.preventDefault();
                if (itemArrossegat) {
                    zone.appendChild(itemArrossegat);
                }
            });
        });
        
        const caixaOriginal = document.getElementById('caixa-magnituds');
        caixaOriginal.addEventListener('dragover', e => {
            e.preventDefault();
        });
        caixaOriginal.addEventListener('drop', e => {
            e.preventDefault();
            if (itemArrossegat) {
                caixaOriginal.appendChild(itemArrossegat);
            }
        });


        // --- LÒGICA DEL BOTÓ FINAL I CORRECCIÓ ---
        document.getElementById('boto-final').addEventListener('click', () => {
            
            const nomAlumne = document.getElementById('nom-alumne').value.trim();
            if (nomAlumne === "") {
                mostrarAvís("Si us plau, escriu el teu nom i cognoms abans de continuar.");
                return;
            }

            const errorsAct1 = [];
            const errorsAct2 = [];
            const errorsAct3 = [];

            // Correcció Activitat 1
            const respostesCorrectes1 = { q1: "s", q2: "m3", q3: "kg", q4: "m/s", q5: "m2", q6: "m" };
            let encerts1 = 0;
            const total1 = Object.keys(respostesCorrectes1).length;
            for (const clau in respostesCorrectes1) {
                const select = document.getElementById(clau);
                const respostaAlumne = select.value;
                if (respostaAlumne === respostesCorrectes1[clau]) {
                    encerts1++;
                } else {
                    const textPregunta = document.querySelector(`label[for="${clau}"]`)?.textContent?.trim() || clau.toUpperCase();
                    errorsAct1.push(`${textPregunta} - resposta escollida: ${respostaAlumne || "Sense resposta"}`);
                }
            }
            const puntuacio1 = (encerts1 / total1) * 10;
            
            // Correcció Activitat 2
            const respostesBasiques = ["longitud", "massa", "temps", "temperatura", "intensitat"];
            const respostesDerivades = ["velocitat", "superficie", "volum", "densitat", "pressio"];
            let encerts2 = 0;
            const total2 = respostesBasiques.length + respostesDerivades.length;
            
            document.querySelectorAll('#zona-basiques .drag-item').forEach(item => {
                if (respostesBasiques.includes(item.dataset.id)) encerts2++;
            });
            document.querySelectorAll('#zona-derivades .drag-item').forEach(item => {
                if (respostesDerivades.includes(item.dataset.id)) encerts2++;
            });
            
            if (document.querySelectorAll('#caixa-magnituds .drag-item').length > 0) {
                mostrarAvís("Si us plau, classifica totes les magnituds de l'activitat 2.");
                return;
            }
            const puntuacio2 = (encerts2 / total2) * 10;

            document.querySelectorAll('.drag-item').forEach(item => {
                const zonaPare = item.parentElement?.id || '';
                const esBasica = respostesBasiques.includes(item.dataset.id);
                const destinacioText = zonaPare === 'zona-basiques' ? 'Bàsiques' : zonaPare === 'zona-derivades' ? 'Derivades' : 'Sense classificar';
                if ((esBasica && zonaPare !== 'zona-basiques') || (!esBasica && zonaPare !== 'zona-derivades')) {
                    errorsAct2.push(`${item.textContent.trim()} -> col·locada a ${destinacioText}`);
                }
            });
            
            // Correcció Activitat 3
            const respostesCorrectes3 = {
                "velocitat":  { valor: ["4", "quatre"], unitat: ["km/h", "quilòmetres per hora"], simbol: ["km/h"] },
                "temps":      { valor: ["3", "tres"], unitat: ["hores", "h"], simbol: ["h"] },
                "longitud":   { valor: ["12", "1200", "20"], unitat: ["quilòmetres", "metres"], simbol: ["km", "m"] },
                "massa":      { valor: ["2400"], unitat: ["grams"], simbol: ["g"] },
                "volum":      { valor: ["500", "15", "quinze"], unitat: ["cm3", "litres", "centímetres cúbics", "cm3"], simbol: ["cm3", "L", "centímetres cúbics"] },
                "temperatura":{ valor: ["12"], unitat: ["°C", "ºC", "graus celsius", "graus centígrads"], simbol: ["°C", "ºC"] },
                "superficie": { valor: ["5000"], unitat: ["metres quadrats"], simbol: ["m2", "m2"] },
                "energia":    { valor: ["1500"], unitat: ["juls"], simbol: ["J"] }
            };
            const normalitzaArray = arr => arr.map(text => (typeof text === "string" ? text.toLowerCase() : text));
            Object.keys(respostesCorrectes3).forEach(clau => {
                respostesCorrectes3[clau] = {
                    valor: normalitzaArray(respostesCorrectes3[clau].valor),
                    unitat: normalitzaArray(respostesCorrectes3[clau].unitat),
                    simbol: normalitzaArray(respostesCorrectes3[clau].simbol)
                };
            });
            const unitatsSiDelText = ["metres", "m", "metres quadrats", "m2", "m2", "juls", "J"].map(text => text.toLowerCase());

            let encerts3 = 0;
            const total3 = 8;
            let filesPlenes = true;

            for (let i = 1; i <= total3; i++) {
                const valorInput = document.getElementById('v' + i).value.trim();
                const unitatInput = document.getElementById('u' + i).value.trim();
                const simbolInput = document.getElementById('s' + i).value.trim();
                const magnitudSel = document.getElementById('m' + i).value;
                const siSel = document.getElementById('si' + i).value;

                if (!valorInput || !unitatInput || !simbolInput || !magnitudSel || !siSel) {
                    filesPlenes = false;
                }
            }

            if (!filesPlenes) {
                mostrarAvís("Si us plau, completa les 5 columnes de les 8 files de l'Activitat 3.");
                return;
            }

            for (let i = 1; i <= total3; i++) {
                const valorOriginal = document.getElementById('v' + i).value.trim();
                const unitatOriginal = document.getElementById('u' + i).value.trim();
                const simbolOriginal = document.getElementById('s' + i).value.trim();
                const magnitudSel = document.getElementById('m' + i).value;
                const siSel = document.getElementById('si' + i).value;

                const valorSel = valorOriginal.toLowerCase();
                const unitatSel = unitatOriginal.toLowerCase();
                const simbolSel = simbolOriginal.toLowerCase();

                // Comprovem cada component
                const dadesCorrectes = respostesCorrectes3[magnitudSel];
                if (!dadesCorrectes) continue;

                const valorCorrecte = dadesCorrectes.valor.includes(valorSel);
                const magnitudCorrecta = dadesCorrectes && magnitudSel !== "";
                const unitatCorrecta = dadesCorrectes.unitat.includes(unitatSel) || dadesCorrectes.simbol.includes(unitatSel);
                const simbolCorrecte = dadesCorrectes.simbol.includes(simbolSel) || dadesCorrectes.unitat.includes(simbolSel);
                
                const esSiLaUnitat = unitatsSiDelText.includes(unitatSel) || unitatsSiDelText.includes(simbolSel);
                const siCorrecte = (esSiLaUnitat && siSel === "si") || (!esSiLaUnitat && siSel === "no");

                // Comptem encerts parcials
                let encertsFila = 0;
                if (valorCorrecte) encertsFila++;
                if (magnitudCorrecta) encertsFila++;
                if (unitatCorrecta || simbolCorrecte) encertsFila++; // només comptem 1 per unitat o símbol
                if (siCorrecte) encertsFila++;

                // Assignem puntuació segons encerts parcials
                let puntsFila = 0;
                if (encertsFila >= 2) {
                    if (encertsFila === 2) puntsFila = 1;
                    else if (encertsFila === 3) puntsFila = 1.5;
                    else if (encertsFila === 4) puntsFila = 2;
                }

                const detallsIncorrectes = [];
                if (!valorCorrecte) detallsIncorrectes.push(`Valor: ${valorOriginal || "(en blanc)"}`);
                if (!magnitudCorrecta) detallsIncorrectes.push(`Magnitud: ${magnitudSel || "(sense selecció)"}`);
                if (!unitatCorrecta) detallsIncorrectes.push(`Unitat: ${unitatOriginal || "(en blanc)"}`);
                if (!simbolCorrecte) detallsIncorrectes.push(`Símbol: ${simbolOriginal || "(en blanc)"}`);
                if (!siCorrecte) {
                    const respostaSi = siSel ? (siSel === "si" ? "Sí" : "No") : "(sense selecció)";
                    detallsIncorrectes.push(`Pertany al SI?: ${respostaSi}`);
                }
                if (detallsIncorrectes.length) {
                    errorsAct3.push(`Fila ${i} - ${detallsIncorrectes.join(' | ')}`);
                }

                encerts3 += puntsFila;
            }
            const puntuacio3 = (encerts3 / (total3 * 2)) * 10; // Ja que ara el màxim és 2 punts per fila, i es pondera el doble

            // Càlcul final i informe (activitat 3 pondera el doble)
            const notaFinal = (puntuacio1 + puntuacio2 + (puntuacio3 * 2)) / 4;
            
            document.getElementById('informe-nom').textContent = nomAlumne;
            emplenaBlocErrors(document.getElementById('resultat-act1'), errorsAct1);
            emplenaBlocErrors(document.getElementById('resultat-act2'), errorsAct2);
            emplenaBlocErrors(document.getElementById('resultat-act3'), errorsAct3);
            document.getElementById('nota-final').textContent = `${notaFinal.toFixed(2)} / 10`;
            
            document.getElementById('contingut-principal').style.display = 'none';
            document.getElementById('informe').style.display = 'block';
            
            generaPdfInforme({ nomAlumne, notaFinal, errorsAct1, errorsAct2, errorsAct3 });
        });
    </script></body>
</html>
