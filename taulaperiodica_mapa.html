<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Mental Interactiu - La Taula Periòdica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.25rem; /* 4px */
        }
        .fill-in-title {
            background-color: #fefce8;
            border: 2px dotted #a16207;
            text-align: center;
            font-weight: 700;
            color: #a16207;
            width: 140px;
            padding: 4px;
            border-radius: 8px;
            margin: 0 4px;
            transition: border-color 0.3s;
        }
        .fill-in-title:focus {
            outline: none;
            border: 2px solid #a16207;
            background-color: #fef9c3;
        }
        .fill-in {
            background-color: transparent;
            border: none;
            border-bottom: 2px dotted #9ca3af;
            text-align: center;
            font-weight: 700;
            color: #1d4ed8;
            width: 120px;
            padding-bottom: 2px;
            transition: border-color 0.3s;
        }
        .fill-in:focus {
            outline: none;
            border-bottom: 2px solid #1d4ed8;
        }
        .hint-trigger {
            cursor: pointer;
            font-size: 1.1rem;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        .hint-trigger:hover {
            opacity: 1;
        }
        .hint-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 0.5rem;
            background-color: #1f2937; /* gray-800 */
            color: #f9fafb; /* gray-50 */
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem; /* 12px */
            width: max-content;
            max-width: 220px;
            text-align: center;
            z-index: 30;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
        }
        .hint-popup.visible {
            opacity: 1;
            visibility: visible;
        }
        #map-wrapper {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin: auto;
        }
        #svg-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: visible;
        }
        .branch-card {
            z-index: 10;
            position: relative;
        }
        .correct { border-color: #16a34a !important; }
        .incorrect { border-color: #dc2626 !important; }

        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background-color: #fff !important; }
            #map-wrapper { page-break-inside: avoid; }
            .no-print { display: none; }
            .fill-in-title, .fill-in { border-color: #000 !important; color: #000 !important; }
            .bg-blue-100, .bg-purple-100, .bg-orange-100, .bg-teal-100, .bg-green-100, .bg-white { background-color: #fff !important; }
            .shadow-md, .shadow-lg { box-shadow: none !important; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col items-center p-4 md:p-6">

    <div class="w-full max-w-4xl text-center">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Mapa Mental: La Taula Periòdica</h1>
        <p class="text-gray-600 mb-8">Completa els conceptes i fes clic a 💡 si necessites una pista. Després, verifica les teves respostes.</p>
    </div>
    
    <div id="map-wrapper">
        <!-- Node Principal -->
        <div class="flex justify-center mb-8">
            <div id="main-node" class="bg-blue-100 border-2 border-blue-300 rounded-xl shadow-lg p-4 w-72 z-10">
                <h2 class="font-bold text-xl text-blue-800">TAULA PERIÒDICA</h2>
                <p class="text-sm text-blue-700">Organitza els elements químics</p>
            </div>
        </div>

        <!-- Graella 2x2 per a les branques -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-12">
            
            <!-- Branca 1: Organització -->
            <div id="branch-1-container" class="flex flex-col items-center p-2 branch-card">
                <div id="branch-1" class="flex flex-col md:flex-row items-center gap-4 md:gap-6">
                    <div id="branch-1-title" class="bg-purple-100 border-2 border-purple-300 rounded-lg shadow-md p-3 w-full md:w-auto flex-shrink-0 flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
                        <h3 class="font-bold text-sm text-purple-800">1. ESTRUCTURA</h3>
                    </div>
                    <div id="branch-1-sub-blocks" class="w-full flex flex-col items-center space-y-3">
                        <div id="sub-block-1" class="bg-white rounded-lg p-3 shadow-md w-full flex flex-col items-center">
                            <div class="input-wrapper"><input type="text" id="input-grup-titol" class="fill-in-title" placeholder=""><span class="hint-trigger" data-target="hint-grup-titol">💡</span><div id="hint-grup-titol" class="hint-popup"></div></div> <span class="font-normal text-xs text-gray-500">(Col.)</span>
                            <p class="mt-2 text-xs">Mateix nº d'<span class="input-wrapper"><input type="text" id="input-grup-prop1" class="fill-in text-xs" placeholder=""><span class="hint-trigger" data-target="hint-grup-prop1">💡</span><div id="hint-grup-prop1" class="hint-popup"></div></span> a l'últim <span class="input-wrapper"><input type="text" id="input-grup-prop2" class="fill-in text-xs" placeholder=""><span class="hint-trigger" data-target="hint-grup-prop2">💡</span><div id="hint-grup-prop2" class="hint-popup"></div></span></p>
                        </div>
                        <div id="sub-block-2" class="bg-white rounded-lg p-3 shadow-md w-full flex flex-col items-center">
                           <div class="input-wrapper"><input type="text" id="input-periode-titol" class="fill-in-title" placeholder=""><span class="hint-trigger" data-target="hint-periode-titol">💡</span><div id="hint-periode-titol" class="hint-popup"></div></div> <span class="font-normal text-xs text-gray-500">(Files)</span>
                            <p class="mt-2 text-xs">Mateix nº de <span class="input-wrapper"><input type="text" id="input-periode-prop" class="fill-in text-xs" placeholder=""><span class="hint-trigger" data-target="hint-periode-prop">💡</span><div id="hint-periode-prop" class="hint-popup"></div></span></p>
                        </div>
                         <div class="bg-white rounded-lg p-3 shadow-md w-full flex flex-col items-center">
                            <p class="font-bold text-sm">Grups Representatius</p>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 mt-2 text-xs">
                                <span class="text-right">G1:</span><div class="input-wrapper"><input type="text" id="input-grup-1" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-grup-1">💡</span><div id="hint-grup-1" class="hint-popup"></div></div>
                                <span class="text-right">G17:</span><div class="input-wrapper"><input type="text" id="input-grup-17" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-grup-17">💡</span><div id="hint-grup-17" class="hint-popup"></div></div>
                                <span class="text-right">G18:</span><div class="input-wrapper"><input type="text" id="input-grup-18" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-grup-18">💡</span><div id="hint-grup-18" class="hint-popup"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Branca 2: Classificació -->
            <div id="branch-2" class="flex flex-col items-center p-2 branch-card">
                <div class="bg-orange-100 border-2 border-orange-300 rounded-lg shadow-md p-3 mb-3 w-full flex items-center justify-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                    <h3 class="font-bold text-sm text-orange-800">2. TIPUS D'ELEMENTS</h3>
                </div>
                <div class="w-full flex flex-col items-center space-y-3">
                     <div class="bg-white rounded-lg p-3 shadow-md w-full flex flex-col items-center">
                        <div class="input-wrapper"><input type="text" id="input-metall-titol" class="fill-in-title" placeholder=""><span class="hint-trigger" data-target="hint-metall-titol">💡</span><div id="hint-metall-titol" class="hint-popup"></div></div>
                        <p class="mt-2 text-xs">Situats a l'<span class="input-wrapper"><input type="text" id="input-metall-prop1" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-metall-prop1">💡</span><div id="hint-metall-prop1" class="hint-popup"></div></span> i centre. Tendeixen a <span class="input-wrapper"><input type="text" id="input-metall-prop2" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-metall-prop2">💡</span><div id="hint-metall-prop2" class="hint-popup"></div></span> e⁻</p>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-md w-full flex flex-col items-center">
                        <div class="input-wrapper"><input type="text" id="input-nometall-titol" class="fill-in-title" placeholder=""><span class="hint-trigger" data-target="hint-nometall-titol">💡</span><div id="hint-nometall-titol" class="hint-popup"></div></div>
                        <p class="mt-2 text-xs">Situats a la <span class="input-wrapper"><input type="text" id="input-nometall-prop1" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-nometall-prop1">💡</span><div id="hint-nometall-prop1" class="hint-popup"></div></span> superior. Tendeixen a <span class="input-wrapper"><input type="text" id="input-nometall-prop2" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-nometall-prop2">💡</span><div id="hint-nometall-prop2" class="hint-popup"></div></span> e⁻</p>
                    </div>
                </div>
            </div>

            <!-- Branca 3: Informació de l'Element -->
            <div id="branch-3" class="flex flex-col items-center p-2 branch-card">
                <div class="bg-teal-100 border-2 border-teal-300 rounded-lg shadow-md p-3 mb-3 w-full flex items-center justify-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-teal-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <h3 class="font-bold text-sm text-teal-800">3. INFORMACIÓ ELEMENT</h3>
                </div>
                <div class="w-full flex flex-col items-center space-y-3">
                    <div class="bg-white rounded-lg p-3 shadow-md w-full">
                        <p class="font-bold text-center text-sm">SÍMBOL</p>
                        <p class="text-xs text-center">(Ex: Fe, O, Ag)</p>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-md w-full flex flex-col items-center">
                        <div class="input-wrapper"><input type="text" id="input-numatomic-titol" class="fill-in-title" placeholder=""><span class="hint-trigger" data-target="hint-numatomic-titol">💡</span><div id="hint-numatomic-titol" class="hint-popup"></div></div>
                        <p class="mt-2 text-xs">Indica el nombre de <span class="input-wrapper"><input type="text" id="input-numatomic-prop" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-numatomic-prop">💡</span><div id="hint-numatomic-prop" class="hint-popup"></div></span></p>
                    </div>
                </div>
            </div>

            <!-- Branca 4: Propietats Periòdiques -->
            <div id="branch-4" class="flex flex-col items-center p-2 branch-card">
                <div class="bg-green-100 border-2 border-green-300 rounded-lg shadow-md p-3 mb-3 w-full flex items-center justify-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                    <h3 class="font-bold text-sm text-green-800">4. PROPIETATS PERIÒDIQUES</h3>
                </div>
                <div class="w-full flex flex-col items-center space-y-3">
                     <div class="bg-white rounded-lg p-3 shadow-md w-full flex flex-col items-center">
                        <p class="font-bold text-sm">Radi Atòmic</p>
                        <p class="mt-2 text-xs">Període (→): <span class="input-wrapper"><input type="text" id="input-radi-periode" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-radi-periode">💡</span><div id="hint-radi-periode" class="hint-popup"></div></span> Grup (↓): <span class="input-wrapper"><input type="text" id="input-radi-grup" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-radi-grup">💡</span><div id="hint-radi-grup" class="hint-popup"></div></span></p>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-md w-full flex flex-col items-center">
                        <p class="font-bold text-sm">Caràcter Metàl·lic</p>
                        <p class="mt-2 text-xs">Període (→): <span class="input-wrapper"><input type="text" id="input-caracter-periode" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-caracter-periode">💡</span><div id="hint-caracter-periode" class="hint-popup"></div></span> Grup (↓): <span class="input-wrapper"><input type="text" id="input-caracter-grup" class="fill-in text-xs"><span class="hint-trigger" data-target="hint-caracter-grup">💡</span><div id="hint-caracter-grup" class="hint-popup"></div></span></p>
                    </div>
                </div>
            </div>
        </div>
        
        <svg id="svg-container"></svg>
    </div>

    <!-- Controls i Banc de Paraules -->
    <div class="w-full max-w-4xl mt-8 p-4 bg-white rounded-lg shadow-md border no-print">
        <div class="flex flex-col md:flex-row justify-center items-center gap-4">
             <button id="check-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Verifica les respostes</button>
             <button id="reset-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors">Reinicia</button>
             <span id="score" class="font-bold text-lg"></span>
        </div>
        <div class="mt-4">
            <h3 class="text-lg font-bold text-center mb-3">Banc de Paraules</h3>
            <div class="flex flex-wrap justify-center gap-x-3 gap-y-2 text-xs text-gray-700">
                 <span class="bg-gray-200 rounded-full px-3 py-1">GRUPS</span><span class="bg-gray-200 rounded-full px-3 py-1">PERÍODES</span><span class="bg-gray-200 rounded-full px-3 py-1">METALLS</span><span class="bg-gray-200 rounded-full px-3 py-1">NO-METALLS</span><span class="bg-gray-200 rounded-full px-3 py-1">NOMBRE ATÒMIC (Z)</span><span class="bg-gray-200 rounded-full px-3 py-1">electrons</span><span class="bg-gray-200 rounded-full px-3 py-1">nivell</span><span class="bg-gray-200 rounded-full px-3 py-1">nivells electrònics</span><span class="bg-gray-200 rounded-full px-3 py-1">Alcalins</span><span class="bg-gray-200 rounded-full px-3 py-1">Halògens</span><span class="bg-gray-200 rounded-full px-3 py-1">Gasos Nobles</span><span class="bg-gray-200 rounded-full px-3 py-1">esquerra</span><span class="bg-gray-200 rounded-full px-3 py-1">dreta</span><span class="bg-gray-200 rounded-full px-3 py-1">perdre</span><span class="bg-gray-200 rounded-full px-3 py-1">guanyar</span><span class="bg-gray-200 rounded-full px-3 py-1">protons</span><span class="bg-gray-200 rounded-full px-3 py-1">augmenta</span><span class="bg-gray-200 rounded-full px-3 py-1">disminueix</span>
            </div>
        </div>
    </div>


    <script>
        const answers = {
            'input-grup-titol': 'GRUPS', 'input-grup-prop1': 'electrons', 'input-grup-prop2': 'nivell',
            'input-periode-titol': 'PERÍODES', 'input-periode-prop': 'nivells electrònics',
            'input-grup-1': 'Alcalins', 'input-grup-17': 'Halògens', 'input-grup-18': 'Gasos Nobles',
            'input-metall-titol': 'METALLS', 'input-metall-prop1': 'esquerra', 'input-metall-prop2': 'perdre',
            'input-nometall-titol': 'NO-METALLS', 'input-nometall-prop1': 'dreta', 'input-nometall-prop2': 'guanyar',
            'input-numatomic-titol': 'NOMBRE ATÒMIC (Z)', 'input-numatomic-prop': 'protons',
            'input-radi-periode': 'disminueix', 'input-radi-grup': 'augmenta',
            'input-caracter-periode': 'disminueix', 'input-caracter-grup': 'augmenta'
        };
        const clues = {
            'input-grup-titol': 'Com s\'anomenen les columnes?', 'input-grup-prop1': 'Partícules a la capa de valència', 'input-grup-prop2': 'La capa més externa',
            'input-periode-titol': 'Com s\'anomenen les files?', 'input-periode-prop': 'També anomenades capes d\'electrons',
            'input-grup-1': 'Grup dels metalls més reactius', 'input-grup-17': 'Els \'formadors de sals\'', 'input-grup-18': 'Elements molt estables, no reactius',
            'input-metall-titol': 'Condueixen l\'electricitat', 'input-metall-prop1': 'On es troben a la taula?', 'input-metall-prop2': 'Què fan amb els seus e⁻ de valència?',
            'input-nometall-titol': 'No condueixen l\'electricitat', 'input-nometall-prop1': 'On es troben a la taula?', 'input-nometall-prop2': 'Què fan per completar la seva capa?',
            'input-numatomic-titol': 'El \'DNI\' de l\'element', 'input-numatomic-prop': 'Partícules positives al nucli',
            'input-radi-periode': 'Més protons atreuen més fort', 'input-radi-grup': 'Afegim una capa sencera',
            'input-caracter-periode': 'És més fàcil guanyar e⁻', 'input-caracter-grup': 'L\'e⁻ de valència està més lluny'
        };

        // --- Lògica per mostrar/amagar pistes individuals ---
        document.addEventListener('DOMContentLoaded', () => {
            // Populate hint popups
            for (const id in clues) {
                const hintPopup = document.getElementById(`hint-${id.replace('input-', '')}`);
                if(hintPopup) {
                    hintPopup.textContent = clues[id];
                }
            }
        });
        
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('hint-trigger')) {
                const targetId = e.target.dataset.target;
                const hintPopup = document.getElementById(targetId);
                
                // Hide all other popups
                document.querySelectorAll('.hint-popup').forEach(p => {
                    if (p.id !== targetId) {
                        p.classList.remove('visible');
                    }
                });

                // Toggle the current one
                if (hintPopup) {
                    hintPopup.classList.toggle('visible');
                }
            } else if (!e.target.closest('.input-wrapper')) {
                // Hide all popups if clicking outside an input area
                document.querySelectorAll('.hint-popup').forEach(p => p.classList.remove('visible'));
            }
        });

        document.getElementById('check-button').addEventListener('click', function() {
            let score = 0;
            const total = Object.keys(answers).length;
            for (const id in answers) {
                const input = document.getElementById(id);
                if (input) {
                    const userAnswer = input.value.trim().toLowerCase();
                    const correctAnswer = answers[id].toLowerCase();
                    input.classList.remove('correct', 'incorrect');
                    if (userAnswer === correctAnswer) {
                        input.classList.add('correct');
                        score++;
                    } else {
                        input.classList.add('incorrect');
                    }
                }
            }
            document.getElementById('score').textContent = `Resultat: ${score} / ${total}`;
        });

        document.getElementById('reset-button').addEventListener('click', function() {
            const inputs = document.querySelectorAll('.fill-in, .fill-in-title');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('correct', 'incorrect');
            });
            document.getElementById('score').textContent = '';
            document.querySelectorAll('.hint-popup').forEach(p => p.classList.remove('visible'));
        });

        function getElementCoords(element) {
            const containerRect = document.getElementById('map-wrapper').getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();
            return {
                top: elementRect.top - containerRect.top, bottom: elementRect.bottom - containerRect.top,
                left: elementRect.left - containerRect.left, right: elementRect.right - containerRect.left,
                width: elementRect.width, height: elementRect.height,
                cx: elementRect.left + elementRect.width / 2 - containerRect.left,
                cy: elementRect.top + elementRect.height / 2 - containerRect.top
            };
        }

        function drawLines() {
            const svg = document.getElementById('svg-container');
            if (!svg) return;
            svg.innerHTML = '';
            const mainNode = document.getElementById('main-node');
            const mainCoords = getElementCoords(mainNode);
            const branches = ['branch-1-container', 'branch-2', 'branch-3', 'branch-4'];
            branches.forEach(id => {
                const branchEl = document.getElementById(id);
                if (branchEl) {
                    const branchCoords = getElementCoords(branchEl);
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', mainCoords.cx); line.setAttribute('y1', mainCoords.bottom);
                    line.setAttribute('x2', branchCoords.cx); line.setAttribute('y2', branchCoords.top);
                    line.setAttribute('stroke', '#9ca3af'); line.setAttribute('stroke-width', '2');
                    svg.appendChild(line);
                }
            });
            if (window.innerWidth >= 768) {
                const titleNode1 = document.getElementById('branch-1-title');
                const subBlocks1 = ['sub-block-1', 'sub-block-2', 'sub-block-3'];
                if (titleNode1) {
                    const titleCoords1 = getElementCoords(titleNode1);
                    subBlocks1.forEach(id => {
                        const subBlockEl = document.getElementById(id);
                        if (subBlockEl) {
                            const subBlockCoords = getElementCoords(subBlockEl);
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', titleCoords1.right); line.setAttribute('y1', titleCoords1.cy);
                            line.setAttribute('x2', subBlockCoords.left); line.setAttribute('y2', subBlockCoords.cy);
                            line.setAttribute('stroke', '#a78bfa'); line.setAttribute('stroke-width', '2');
                            svg.appendChild(line);
                        }
                    });
                }
            }
        }
        window.addEventListener('load', drawLines);
        window.addEventListener('resize', drawLines);
    </script>

</body>
</html>
